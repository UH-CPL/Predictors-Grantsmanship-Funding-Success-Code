---
title: "Core Questions"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(plotrix)
library(plotly)
library(tools)
library(plotrix)
library(plotly)
library(grid)
library(gridExtra)
library(ggpubr)
library(cowplot)
library(reshape2)
library(plyr)
library(ggplot2)
```

```{r, echo=FALSE}
root_dir <- getwd()
project_directory <- dirname(root_dir)
data_dir <- file.path(project_directory, 'curated-data')
plot_dir <- file.path(project_directory, 'Plots')
data_file_name <- 'StandardPart.csv'
curated_data_dir <- file.path(project_directory, 'curated-data')
StandardPart <-
  read.csv(file.path(data_dir, data_file_name), stringsAsFactors = FALSE)
```


```{r, echo=FALSE}
title_list = c(
  "States",
  "Salary dependance on external grants",
  "Percentage of research operations funded by external grants",
  "Any looming deadline- Today/Next couple of days?",
  "Today's workload",
  "Workplace",
  "Research style",
  "Working hours- In a typical week",
  "Break frequency",
  "Email response style",
  "Participants submitting funding proposals",
  "Average number of proposals per year",
  "Funding agencies",
  "Perceived proposal success rate",
  "Length of proposal composition period",
  "Length of supporting research for proposals",
  "Proposal deadline week workload wrt a typical week",
  "Timing of proposal submission",
  "Stress level on proposal deadlines wrt regular working days",
  "Participants submitting papers in refereed conferences",
  "Average number of conference papers per year",
  "CORE rank of conferences",
  "Perceived success rate in  conference submissions",
  "Length of conference paper composition period",
  "Length of supporting research for conference papers",
  "Conference deadline week workload wrt a typical week",
  "Timing of conference paper submission",
  "Stress level on conference deadlines wrt regular working days"
)

```





```{r, echo=FALSE, warning=FALSE}
Core_Questions<- StandardPart %>% select(record_id, state_do_you_reside, how_many_months_of_your_sa, what_is_your_current_level,
                  do_you_have_a_deadline_tod, please_indicate_your_workl, where_you_typically_wor,
                  test,in_a_typical_workday_how_m, in_a_typical_day_how_often,
                  how_do_you_usually_handle,  funding_proposal, what_is_the_average_number,
                  funding_agency,  hy, how_far_in_advance_do_you,
                  what_is_the_length_of_supp, in_the_week_leading_to_a_p, when_you_typically_subm,
                  stress_level_in_a_fundi, refereed_conference, wha_average_number,
                  core_rank, if_you_submit_manuscripts,  far_in_advance_do_you,
                  length_of_supp, in_the_week_leading_to_a_c,
                  you_typically_subm, ss_level_in_a_fundi)



Core_Questions<-Core_Questions  %>%  dplyr::rename(
                                          # h_index="google_scholar_h_index",
                                           Record_id="record_id",
                                           State="state_do_you_reside",
                                           S_D_E="how_many_months_of_your_sa",     ## salary depends on external grants
                                           RO_F_EG="what_is_your_current_level",   ## Research operations funded by external grants
                                           Deadline_today="do_you_have_a_deadline_tod",
                                           Workload_today="please_indicate_your_workl",
                                           Workplace="where_you_typically_wor",
                                           R_Style="test",                         ## Research Style
                                           TW_W_H="in_a_typical_workday_how_m",    ## Typical week working hours
                                           # TW_Research="ti_research",              ## Typical week Research
                                           Break="in_a_typical_day_how_often",     ## Break Frequency
                                           Email="how_do_you_usually_handle",      ## Email respnse style
                                           A_N_Pro="what_is_the_average_number",   ## Average Number of Proposal per year
                                           Success="hy",                           ## Success Rate in the proposal
                                           Com_Proposal="how_far_in_advance_do_you",# Composing Proposal
                                           L_Of_SR="what_is_the_length_of_supp",   ## Length of supporting research
                                           W_WB_PD="in_the_week_leading_to_a_p",   ## Work load a week before Proposal Deadline
                                           # Research_WB="week_research",            ## Research percentage a week before Proposal
                                           # Research_DD="proposal_research",        ## Research percentage in the Proposal deadlines day
                                           Submit_P="when_you_typically_subm",     ## Submit Proposal
                                           Stress_PD="stress_level_in_a_fundi",    ## Stress leven on Proposal Deadline
                                           A_N_Conf_Pap="wha_average_number"
                                           )


```



```{r, echo=FALSE}
count(Core_Questions$Break)
for(i in 1:nrow(Core_Questions)){
  
  #######---------Salary depends of external grants------------#################
  if (Core_Questions$S_D_E[i]=="Three months"){
    Core_Questions$S_D_E[i]="Three months"
  }else if (Core_Questions$S_D_E[i]=="2 months" || Core_Questions$S_D_E[i]==2){
    Core_Questions$S_D_E[i]="Two months"
  }else{
    Core_Questions$S_D_E[i]="Other"
  }


  if (Core_Questions$RO_F_EG[i]=="Not funded"){
    Core_Questions$RO_F_EG[i]="Not funded"
  } else if (Core_Questions$RO_F_EG[i]=="25-1%"){
    Core_Questions$RO_F_EG[i]="1-25%"
  } else if (Core_Questions$RO_F_EG[i]=="50-25%"){
    Core_Questions$RO_F_EG[i]="25-50%"
  } else if (Core_Questions$RO_F_EG[i]=="75-50%"){
    Core_Questions$RO_F_EG[i]="50-75%"
  } else if (Core_Questions$RO_F_EG[i]=="100-75%"){
    Core_Questions$RO_F_EG[i]="75-100%"
  } else{
    Core_Questions$RO_F_EG[i]="Fully funded"
  }
  
  
  if (Core_Questions$Workplace[i]=="Home"){
    Core_Questions$Workplace[i]="Home"
  } else if (Core_Questions$Workplace[i]=="Office"){
    Core_Questions$Workplace[i]="Office"
  } else {
    Core_Questions$Workplace[i]="Other"
  }

  if (Core_Questions$Email[i]=="Answer email in batches once  or twice per day"){
    Core_Questions$Email[i]="Reply Once/Twice"
  }else {
    Core_Questions$Email[i]="Reply instantly"
  }

  
  
  
  if (Core_Questions$Break[i]=="Every 1-2 hours"){
    Core_Questions$Break[i]="Every 1-2 hours"
  } else if (Core_Questions$Break[i]=="Every 3-4 hours"){
    Core_Questions$Break[i]="Every 3-4 hours"
  } else if (Core_Questions$Break[i]=="Every hour"){
    Core_Questions$Break[i]="Every hour"
  } else{
    Core_Questions$Break[i]="Other"
  }
  
  
  
  if (Core_Questions$Submit_P[i]=="Minutes before deadline"){
    Core_Questions$Submit_P[i]="Minutes before"
  } else if (Core_Questions$Submit_P[i]=="1-3 hours before deadline"){
    Core_Questions$Submit_P[i]="1-3 hours before"
  } else if (Core_Questions$Submit_P[i]=="3-6 hours before deadline"){
    Core_Questions$Submit_P[i]="3-6 hours before"
  }  else if (Core_Questions$Submit_P[i]=="1 day before deadline"){
    Core_Questions$Submit_P[i]="1 day before"
  } else if (Core_Questions$Submit_P[i]==""){
    Core_Questions$Submit_P[i]=NA
  } else {
    Core_Questions$Submit_P[i]="2 or more days before"
  }
  
    if (Core_Questions$you_typically_subm[i]=="Minutes before deadline"){
    Core_Questions$you_typically_subm[i]="Minutes before"
  } else if (Core_Questions$you_typically_subm[i]=="1-3 hours before deadline"){
    Core_Questions$you_typically_subm[i]="1-3 hours before"
  } else if (Core_Questions$you_typically_subm[i]=="3-6 hours before deadline"){
    Core_Questions$you_typically_subm[i]="3-6 hours before"
  }  else if (Core_Questions$you_typically_subm[i]=="1 day before deadline"){
    Core_Questions$you_typically_subm[i]="1 day before"
  } else if (Core_Questions$you_typically_subm[i]==""){
    Core_Questions$you_typically_subm[i]=NA
  } else {
    Core_Questions$you_typically_subm[i]="2 or more days before"
  }
  
}
  levels(factor(Core_Questions$Break))
  count(Core_Questions$S_D_E)
```

```{r}
  levels(factor(Core_Questions$State))
  levels(factor(Core_Questions$S_D_E))
  levels(factor(Core_Questions$RO_F_EG))
  levels(factor(Core_Questions$Deadline_today))
  levels(factor(Core_Questions$Workload_today))
  levels(factor(Core_Questions$Workplace))
  levels(factor(Core_Questions$R_Style))
  levels(factor(Core_Questions$TW_W_H))
  levels(factor(Core_Questions$Break))
  levels(factor(Core_Questions$Email))
  levels(factor(Core_Questions$funding_proposal))
  levels(factor(Core_Questions$A_N_Pro))
  levels(factor(Core_Questions$funding_agency))
  levels(factor(Core_Questions$Success))
  levels(factor(Core_Questions$Com_Proposal))
  levels(factor(Core_Questions$L_Of_SR))
  levels(factor(Core_Questions$W_WB_PD))
  levels(factor(Core_Questions$Submit_P))
  levels(factor(Core_Questions$Stress_PD))
  levels(factor(Core_Questions$refereed_conference))
  levels(factor(Core_Questions$A_N_Conf_Pap))
  levels(factor(Core_Questions$core_rank))
  levels(factor(Core_Questions$if_you_submit_manuscripts))
  levels(factor(Core_Questions$far_in_advance_do_you))
  levels(factor(Core_Questions$length_of_supp))
  levels(factor(Core_Questions$in_the_week_leading_to_a_c))
  levels(factor(Core_Questions$you_typically_subm))
  levels(factor(Core_Questions$ss_level_in_a_fundi))
  
  
  count(Core_Questions$funding_agency)
```

```{r, echo=FALSE}


list1 = c(
  "Arizona",
  "California",
  "Florida",
  "Georgia",
  "Illinois",
  "Maryland",
  "Michigan",
  "Minnesota",
  "New Mexico",
  "Ohio",
  "Pennsylvania",
  "Texas",
  "Virginia",
  "Wisconsin"
)
list2 = c("Two months", "Three months", "Other")

list3 = c("Not funded",
          "1-25%",
          "25-50%",
          "50-75%",
          "75-100%",
          "Fully funded")
list4 = c("No", "Yes")

list5 = c("Light", "Standard", "Heavy")
list6 = c("Home", "Office", "Other")

list7 = c("Hands-off", "Hands-on")
list8 = c("< 30", "30-40", "40-50", "> 50")

list9 = c("Every hour", "Every 1-2 hours", "Every 3-4 hours", "Other")
list10 = c("Reply instantly", "Reply Once/Twice")

list11 = c("No", "Yes")
list12 = c("1-2", "3-4", "5-6", "7-9", ">=10")

list13 = c("DOD", "DOE", "NASA", "NIH", "NIJ", "NRC","NSF", "Private Foundation", "TRB", "USDA")
list14 = c("< 10%", "10-20%", "20-30%", "30-50%", "50-75%", "75-90%", "> 90%")

list15 = c("1-2 weeks", "2-4 weeks", "1-2 months", "> 2 months")
list16 = c("< 1 month", "1-3 months", "3-6 months", "6-12 months", "> 12 months")

list17 = c("Significantly less", "Less", "About the same", "More", "Significantly more")
list18 = c(
  "Minutes before",
  "1-3 hours before",
  "3-6 hours before",
  "1 day before",
  "2 or more days before"
)

list19 = c("Extremely less",
           "Significantly less",
           "Same",
           "Significantly  more",
           "Extremely  more")
list20 = c("No", "Yes")

list21 = c("1-2", "3-4", "5-6", "7-9", ">= 10")
list22 = c("C", "B", "A", "A*")

list23 = c("< 10%", "10-20%", "20-30%", "30-50%", "50-75%", "75-90%", "> 90%")
list24 = c("< 1 week", "1-2 weeks", "2-4 weeks", "1-2 months", "> 2 months")

list25 = c("< 1 month", "1-3 months", "3-6 months", "6-12 months", "> 12 months")
list26 = c( "Significantly less","Less","About the same", "More", "Significantly more")

list27 = c(
  "Minutes before",
  "1-3 hours before",
  "3-6 hours before",
  "1 day before",
  "2 or more days before"
)

# "Extremely less",
# "Significantly less",

list28 = c("Extremely less",
           "Significantly less",
           "Same",
           "Significantly  more",
           "Extremely  more")

Ticks_list <-
  list(list1,
       list2,
       list3,
       list4,
       list5,
       list6,
       list7,
       list8,
       list9,
       list10,
       list11,
       list12,
       list13,
       list14,
       list15,
       list16,
       list17,
       list18,
       list19,
       list20,
       list21,
       list22,
       list23,
       list24,
       list25,
       list26,
       list27,
       list28)
```

```{r}
# ######Test a single core questions
#   temp <- count(Core_Questions$Workload_today)
#   colnames(temp) <- c("item", "count")
#   temp <- temp[!(temp$item == ""),]
# 
#  bar_plot <- ggplot(data = temp, aes(x = item, y = count)) +
#     geom_bar(stat = "identity",
#              width = 0.5,
#              fill = "steelblue") +
#     theme_minimal() +
#     scale_y_continuous(breaks = seq(0, ylimit, by = 5),
#                        limits = c(0, ylimit)) +
#     labs(x = "", y = "Participant count", title = title_list[i - 1]) +
#     theme(
#       panel.grid.major = element_blank(),
#       panel.grid.minor = element_blank(),
#       plot.title = element_text(hjust = 0.5),
#       axis.text.x = element_text(
#         face = "bold",
#         size = 10 ,
#         angle = 30,
#         hjust = 1
#       ),
#       axis.text.y = element_text(face = "bold", size = 10)
#     )+
#    scale_x_discrete( limits=list[[1]])
#  
#  bar_plot
```


```{r, echo=FALSE}

# ylimit= round_any(nrow(Core_Questions), 10,f = ceiling)
# ylimit= 200


plot_list<-list()

for (i in 2:length(Core_Questions)) {
  ylimit= 250
  if ((i == 3) | (i == 5) | (i == 8) | (i == 11) |(i == 12) |(i == 14)){
    ylimit = 400
  }
  temp <- count(Core_Questions[i])
  colnames(temp) <- c("item", "count")
  temp <- temp[!(temp$item == ""),]
  temp <- temp[order(temp$count), ]
  
  bar_plot <- ggplot(data = temp, aes(x = item, y = count)) +
    geom_bar(stat = "identity",
             width = 0.5,
             fill = "steelblue") +
    theme_bw() +
    scale_y_continuous(breaks = seq(0, ylimit, by = 50),
                       limits = c(0, ylimit)) +
    labs(x = "", y = "Count", title = title_list[i - 1]) +
    theme(
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      plot.title = element_text(hjust = 0.5),
      axis.text.x = element_text(
        face = "bold",
        size = 10 ,
        angle = 30,
        hjust = 1
      ),
      axis.text.y = element_text(face = "bold", size = 10)
    )+scale_x_discrete( limits=Ticks_list[[i-1]])

  plot_list[[length(plot_list) + 1]] <- bar_plot
  
}
as.character("state_do_you_reside")

plots_act=ggarrange(plotlist = plot_list, nrow = 2, ncol = 1)

for (i in 1:length(plots_act)){
      final_plot<-plot_grid(plots_act[[i]])
      filename<-paste("plot",i,".pdf",sep="")
      full_path<-file.path(plot_dir, filename)
      ggsave(full_path, final_plot, width = 8.5, height = 11, units = "in")
      print(final_plot)
}

```

